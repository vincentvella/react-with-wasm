name: React With Wasm CI

on:
  push:
    branches:
      - master

jobs:
  build-and-deploy:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]
        rust: [stable]
        rustup: [stable]
        node_version: [10]
        
    steps:
    - uses: actions/checkout@v1
    - uses: hecrj/setup-rust-action@master
      with:
        rust-version: ${{ matrix.rust }}
        
    - name: Download WASM Pack
      run: |
        curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh
        wasm-pack --version
        
    - name: Use Node.js version 10
      uses: actions/setup-node@v1
      with:
        version: ${{ matrix.node_version }}
        
    - name: Build WASM Module
      working-directory: ./wasm-lib
      run: |
        wasm-pack build
 
    - name: Publish Github Pages
      working-directory: ./react-app
      run: |
        git config --global user.email "vincevella0@gmail.com"
        git config --global user.name "vincentvella"
        yarn install
        yarn run deploy